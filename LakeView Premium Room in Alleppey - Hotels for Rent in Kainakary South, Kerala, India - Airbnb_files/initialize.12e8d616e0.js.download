__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hasPermission=p,e.requestPermission=async function(){if(!(0,o.supportsPushNotifications)())return!1;if('denied'===Notification.permission)return!1;if('granted'===Notification.permission)return!0;f((()=>'Attempting to request permissions'));const n=await Notification.requestPermission(),{datadogTags:u}=await(0,s.getInitializeOptions)();switch(f((()=>`Resulting permission: ${n}`)),n){case'granted':(0,t.airdogCount)('service_worker.push_notifications.permission_granted',1,u);break;case'denied':(0,t.airdogCount)('service_worker.push_notifications.permission_denied',1,u);break;case'default':(0,t.airdogCount)('service_worker.push_notifications.permission_default',1,u)}return'granted'===n},e.shouldShowPushNotificationsOptIn=async function(){if(await c())return!1;if('undefined'==typeof Notification)return f((()=>'Not showing push notifications since they\u2019re not supported')),!1;if('denied'===Notification.permission)return f((()=>'Not showing push notifications due to not having permission')),!1;return!0};var t=r(d[0]),n=r(d[1]),o=r(d[2]),s=r(d[3]),u=r(d[4]);const f=(0,n.createLogger)('Push:Permissions',(0,n.createPrefixStyle)('#b95f6f','#fff'));async function c(){return!!p()&&(0,u.hasValidDeviceId)()}function p(){return'undefined'!=typeof Notification&&'granted'===Notification.permission}}),"0a0e02",["3e4681","102445","f09318","436356","e62feb"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.makeDatadogTags=function(o){let s='unknown';(0,n.isAndroid)()?s='android':(0,n.isIos)()&&(s='ios');const t=`os:${s}`,u=`browser:${(0,n.getUserAgentName)()}`;return[t,u,o].join(',')};var n=r(d[0])}),"159ba6",["e9b7bf"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function({datadogTags:t,niobeClient:c}){'undefined'!=typeof Notification&&'denied'===Notification.permission&&(0,o.airdogCount)('service_worker.push_permission_denied',1,t);if(!(0,u.hasPermission)())return;f=t,v=c,h();try{if(!n.default.isLoggedIn())return void(0,l.clearSubscription)();(0,l.updateSubscriptionIfOptedIn)()}catch(t){(0,s.reportError)(t)}},e.getInitializeOptions=async function(){if(!navigator||!navigator.serviceWorker)throw new Error('Push notifications requires a service worker to be available.');const n=await navigator.serviceWorker.ready;if(!n||!n.active)throw new Error('No service worker was activated, push notifications are not available.');await Promise.race([_,c.scheduler.wait({delay:3e4})]);const{tracking_context:s}=t.default.get('layout-init'),{controller:u}=s,l='homes-host-loop'===u?'GLOBAL_HOST':'GLOBAL_TRAVEL',h=n.active.scriptURL.split('/'),w=`/${h[h.length-1]}`,b=(0,p.makeDatadogTags)(`registered_path:${w}`),y=f?[f,b].join(','):b;v||(0,o.airdogCount)('service_worker.push_initialize_timeout',1,y);return{datadogTags:y,appType:l,niobeClient:v,pushNotificationsKey:t.default.get('pushNotificationsKey'),serviceWorkerRegistration:n}};var t=babelHelpers.interopRequireDefault(r(d[0])),o=r(d[1]),n=babelHelpers.interopRequireDefault(r(d[2])),s=r(d[3]),c=r(d[4]),u=r(d[5]),l=r(d[6]),p=r(d[7]);let f,v,h;const _=new Promise((t=>{h=t}))}),"436356",["0a58da","3e4681","06a99e","f2f40f","a2c93f","0a0e02","627c69","159ba6"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Workbox=void 0,e.messageSW=n;try{self["workbox:window:6.1.1"]&&_()}catch(n){}function n(n,t){return new Promise((function(o){var s=new MessageChannel;s.port1.onmessage=function(n){o(n.data)},n.postMessage(t,[s.port2])}))}function t(n,t){for(var o=0;o<t.length;o++){var s=t[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function o(n,t){(null==t||t>n.length)&&(t=n.length);for(var o=0,s=new Array(t);o<t;o++)s[o]=n[o];return s}function s(n,t){var s;if("undefined"==typeof Symbol||null==n[Symbol.iterator]){if(Array.isArray(n)||(s=(function(n,t){if(n){if("string"==typeof n)return o(n,t);var s=Object.prototype.toString.call(n).slice(8,-1);return"Object"===s&&n.constructor&&(s=n.constructor.name),"Map"===s||"Set"===s?Array.from(n):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?o(n,t):void 0}})(n))||t&&n&&"number"==typeof n.length){s&&(n=s);var c=0;return function(){return c>=n.length?{done:!0}:{done:!1,value:n[c++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(s=n[Symbol.iterator]()).next.bind(s)}try{self["workbox:core:6.1.1"]&&_()}catch(n){}var c=function(){var n=this;this.promise=new Promise((function(t,o){n.resolve=t,n.reject=o}))};function u(n,t){var o=location.href;return new URL(n,o).href===new URL(t,o).href}var v=function(n,t){this.type=n,Object.assign(this,t)};function f(n,t,o){return o?t?t(n):n:(n&&n.then||(n=Promise.resolve(n)),t?n.then(t):n)}function h(){}var l={type:"SKIP_WAITING"};function p(n,t){if(!t)return n&&n.then?n.then(h):Promise.resolve()}var y=(function(o){var s,h;function y(n,t){var s,h;return void 0===t&&(t={}),(s=o.call(this)||this).nn={},s.tn=0,s.rn=new c,s.en=new c,s.on=new c,s.un=0,s.an=new Set,s.cn=function(){var n=s.fn,t=n.installing;s.tn>0||!u(t.scriptURL,s.sn)||performance.now()>s.un+6e4?(s.vn=t,n.removeEventListener("updatefound",s.cn)):(s.hn=t,s.an.add(t),s.rn.resolve(t)),++s.tn,t.addEventListener("statechange",s.ln)},s.ln=function(n){var t=s.fn,o=n.target,c=o.state,u=o===s.vn,f={sw:o,isExternal:u,originalEvent:n};!u&&s.mn&&(f.isUpdate=!0),s.dispatchEvent(new v(c,f)),"installed"===c?s.wn=self.setTimeout((function(){"installed"===c&&t.waiting===o&&s.dispatchEvent(new v("waiting",f))}),200):"activating"===c&&(clearTimeout(s.wn),u||s.en.resolve(o))},s.dn=function(n){var t=s.hn;t===navigator.serviceWorker.controller&&(s.dispatchEvent(new v("controlling",{sw:t,originalEvent:n,isUpdate:s.mn})),s.on.resolve(t))},s.gn=(h=function(n){var t=n.data,o=n.source;return f(s.getSW(),(function(){s.an.has(o)&&s.dispatchEvent(new v("message",{data:t,sw:o,originalEvent:n}))}))},function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];try{return Promise.resolve(h.apply(this,n))}catch(n){return Promise.reject(n)}}),s.sn=n,s.nn=t,navigator.serviceWorker.addEventListener("message",s.gn),s}h=o,(s=y).prototype=Object.create(h.prototype),s.prototype.constructor=s,s.__proto__=h;var w,b,E=y.prototype;return E.register=function(n){var t=(void 0===n?{}:n).immediate,o=void 0!==t&&t;try{var s=this;return(function(n,t){var s=(function(){if(!o&&"complete"!==document.readyState)return p(new Promise((function(n){return window.addEventListener("load",n)})))})();return s&&s.then?s.then(t):t()})(0,(function(){return s.mn=Boolean(navigator.serviceWorker.controller),s.yn=s.pn(),f(s.bn(),(function(n){s.fn=n,s.yn&&(s.hn=s.yn,s.en.resolve(s.yn),s.on.resolve(s.yn),s.yn.addEventListener("statechange",s.ln,{once:!0}));var t=s.fn.waiting;return t&&u(t.scriptURL,s.sn)&&(s.hn=t,Promise.resolve().then((function(){s.dispatchEvent(new v("waiting",{sw:t,wasWaitingBeforeRegister:!0}))})).then((function(){}))),s.hn&&(s.rn.resolve(s.hn),s.an.add(s.hn)),s.fn.addEventListener("updatefound",s.cn),navigator.serviceWorker.addEventListener("controllerchange",s.dn,{once:!0}),s.fn}))}))}catch(n){return Promise.reject(n)}},E.update=function(){try{return this.fn?p(this.fn.update()):void 0}catch(n){return Promise.reject(n)}},E.getSW=function(){return void 0!==this.hn?Promise.resolve(this.hn):this.rn.promise},E.messageSW=function(t){try{return f(this.getSW(),(function(o){return n(o,t)}))}catch(n){return Promise.reject(n)}},E.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&n(this.fn.waiting,l)},E.pn=function(){var n=navigator.serviceWorker.controller;return n&&u(n.scriptURL,this.sn)?n:void 0},E.bn=function(){try{var n=this;return(function(n,t){try{var o=n()}catch(n){return t(n)}return o&&o.then?o.then(void 0,t):o})((function(){return f(navigator.serviceWorker.register(n.sn,n.nn),(function(t){return n.un=performance.now(),t}))}),(function(n){throw n}))}catch(n){return Promise.reject(n)}},w=y,(b=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&t(w.prototype,b),y})((function(){function n(){this.Pn=new Map}var t=n.prototype;return t.addEventListener=function(n,t){this.Sn(n).add(t)},t.removeEventListener=function(n,t){this.Sn(n).delete(t)},t.dispatchEvent=function(n){n.target=this;for(var t,o=s(this.Sn(n.type));!(t=o()).done;)(0,t.value)(n)},t.Sn=function(n){return this.Pn.has(n)||this.Pn.set(n,new Set),this.Pn.get(n)},n})());e.Workbox=y}),"47df49",[]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.clearSubscription=I,e.hasValidPushSubscription=async function(){const{serviceWorkerRegistration:t}=await(0,f.getInitializeOptions)();if(!await(0,c.hasValidDeviceId)())return!1;return!!await t.pushManager.getSubscription()},e.optIntoPushNotifications=async function(){const t=await(0,f.getInitializeOptions)();if(!await(0,l.requestPermission)())return v({options:t,metric:'permission_denied'}),!1;v({options:t,metric:'permission_granted'});if(await(0,c.hasValidDeviceId)())return v({description:"Using validated cached device id.",options:t,metric:'device_id_cached'}),await _(),!0;v({description:"Creating a new device id and push subscription.",options:t,metric:'no_device_id_cached'});try{await I()}finally{await _()}return!0},e.updateSubscriptionIfOptedIn=async function(){if(!await(0,c.hasValidDeviceId)())return h((()=>'user has not opted in, attempt to find and clear invalid push subscription')),I();return _()};var t=babelHelpers.interopRequireDefault(r(d[0])),n=babelHelpers.interopRequireDefault(r(d[1])),s=r(d[2]),o=r(d[3]),c=babelHelpers.interopRequireWildcard(r(d[4])),u=babelHelpers.interopRequireDefault(r(d[5])),p=babelHelpers.interopRequireDefault(r(d[6])),l=r(d[7]),f=r(d[8]),b=r(d[9]);const w='Service Worker:Push Initializer',h=(0,s.createLogger)(w,(0,s.createPrefixStyle)('rebeccapurple','#fff')),v=(0,b.createMarkMilestone)(w,'web_push');async function y(s){const{tracking_context:o={}}=t.default.get('layout-init'),{appType:p}=await(0,f.getInitializeOptions)(),l=n.default.current().id,b=await(0,c.default)(l);if(!l)throw new Error('Cannot make a token without a valid userId.');return{appType:p,appVersion:`${o.controller}:${o.version}`,buildType:'RELEASE',deviceType:(0,u.default)(),deviceVersion:navigator.userAgent,nativeDeviceId:b,timeStamp:String((new Date).getTime()),token:JSON.stringify(s),tokenType:'VAPID',userId:l}}async function _(){if(!await(0,l.hasPermission)())return;const t=await(0,f.getInitializeOptions)(),{pushNotificationsKey:n,serviceWorkerRegistration:s}=t;try{let o=await s.pushManager.getSubscription();o||(o=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n}));const c=await y(o),u=await(0,p.default)(c);return v({description:`Push notifications successfully initialized with key: "${n}".`,options:t,metric:'push_subscribe_success',metricPrefix:'service_worker'}),u}catch(n){v({options:t,metric:'push_subscribe_unknown_failure',metricPrefix:'service_worker'}),(0,o.reportError)(n,{fingerprint:null!=n&&n.message?['PushUnknownFailure']:void 0,originalError:n}),await I()}}async function I(){const t=await(0,f.getInitializeOptions)(),{serviceWorkerRegistration:n}=t,s=await n.pushManager.getSubscription();if(!s)return!0;try{await s.unsubscribe()}catch(n){(0,o.reportError)(n,{originalError:n}),v({options:t,metric:'unsubscribe_failure'})}return h((()=>'Push subscription has been unsubscribed.')),!0}}),"627c69",["0a58da","06a99e","102445","f2f40f","e62feb","d93056","96c3e8","0a0e02","436356","fae72a"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.addUpdateCurrencyCallback=function(t){u=t},e.default=function(o,s){(0,l.changeCurrency)(o).then((()=>{if((0,n.default)('currency',o,{path:'/'}),c.default.setCurrent({...c.default.current(),curr:o}),u(),s){const[n,c]=s.split('#'),[l,u]=n.split('?'),p=(0,t.stringify)({...(0,t.parse)(u),display_currency:o},{arrayFormat:'brackets'});return void window.location.assign(`${l}?${p}${c?`#${c}`:''}`)}const{pathname:p}=window.location;window.location.replace(`${p}${(0,l.replaceCurrencyParam)(o)}`)}))};var t=r(d[0]),n=babelHelpers.interopRequireDefault(r(d[1])),c=babelHelpers.interopRequireDefault(r(d[2])),l=r(d[3]);let u=()=>{}}),"737fda",["e950a3","e7272f","06a99e","d46747"]);
__d((function(g,r,i,a,m,e,d){"use strict";let o,t;Object.defineProperty(e,"__esModule",{value:!0}),e.SignupSocialFields=e.SignupFields=void 0,e.SignupFields=o,(function(o){o.password="password",o.passwordConfirm="passwordConfirm",o.email="email",o.firstName="firstName",o.firstNamePreferred="firstNamePreferred",o.lastName="lastName",o.birthdateDay="birthdateDay",o.birthdateYear="birthdateYear",o.birthdateMonth="birthdateMonth",o.phoneNumber="phoneNumber",o.countryCode="countryCode",o.collectionOfPersonalInformation="collectionOfPersonalInformation",o.overseasTransferOfPersonalData="overseasTransferOfPersonalData",o.receivePromotionalEmail="receivePromotionalEmail",o.receivePromotionalSMS="receivePromotionalSMS",o.tosCheckBox="tosCheckBox",o.verificationCode="verificationCode",o.geetestChallenge="geetestChallenge",o.geetestValidate="geetestValidate",o.geetestSeccode="geetestSeccode",o.phoneSignupFlow="phoneSignupFlow",o.redirectUrl="redirectUrl"})(o||(e.SignupFields=o={})),e.SignupSocialFields=t,(function(o){o.oauth2Service="oauth2Service",o.providerUid="providerUid",o.authCodeCacheKey="authCodeCacheKey",o.nationalNumber="nationalNumber",o.authType="authType"})(t||(e.SignupSocialFields=t={}))}),"76b333",[]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(t){var s,f;const{niobeClient:v}=await(0,o.getInitializeOptions)(),{errors:c,data:p}=await v.mutate({mutation:l.default,variables:{request:t}});if(c&&c.length>0){var b,h;const o='Failed to send push token due to network error';u((()=>[o,c]));const l={extra:{...c[0],...t},fingerprint:['PushTokenUpdateFailure']},s=new Error(null!==(b=null===(h=c[0])||void 0===h?void 0:h.message)&&void 0!==b?b:o);throw(0,n.reportError)(s,l),s}return u((()=>['Sent push token to upstream server',p])),null==p||null===(s=p.pleiades)||void 0===s||null===(f=s.writeToken)||void 0===f?void 0:f.deviceId};var t=r(d[0]),n=r(d[1]),o=r(d[2]),l=babelHelpers.interopRequireDefault(r(d[3]));const u=(0,t.createLogger)('Push:Send Token',(0,t.createPrefixStyle)('#b95f6f','#fff'))}),"96c3e8",["102445","f2f40f","436356","dbdcfd"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=babelHelpers.interopRequireDefault(r(d[0]));function c(){const t=babelHelpers.interopRequireDefault(r(d[1]));return c=function(){return t},t}e.default=class{constructor(){this.currenciesCache=void 0,this.resource=void 0,this.init()}init(){t.default.configure({apiKey:c().default.key(),host:'monorail',hosts:{monorail:'/api/v2'}}),this.resource=new t.default('currencies'),this.currenciesCache={}}fetch(t=!1){const c={_format:'for_mcp',sort:'top_currency',style:'group'},s=`for_mcp@${c.sort}@${c.style}`;return!t&&this.currenciesCache[s]||(this.currenciesCache[s]=this.resource.collection(c)),this.currenciesCache[s]}}}),"9b0a1c",["716f9c","e2869c"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.logSessionEnd=function(t){return n.default.logUniversalSessionEndEvent(t)},e.logSessionStart=function(t){return n.default.logUniversalSessionStartEvent(t)};var n=babelHelpers.interopRequireDefault(r(d[0]))}),"9e7031",["c8b97a"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.addLoginCallback=function(n){return o.default.removeListener('login',n),o.default.on('login',n),()=>{o.default.removeListener('login',n)}},e.addLoginCompleteCallback=function(n){return o.default.removeListener('login:complete',n),o.default.on('login:complete',n),()=>{o.default.removeListener('login:complete',n)}},e.addLogoutCallback=function(n){return o.default.removeListener('logout',n),o.default.on('logout',n),()=>{o.default.removeListener('logout',n)}},e.broadcastLogin=function(n){o.default.emit('login:before'),o.default.emit('login'),f((()=>{b(!0),o.default.emit('login:complete'),setTimeout((()=>{null==n||n()}),0)}))},e.callFunctionUponLogin=f,e.logModalSession=function(o={}){if(o.sessionEvent){const n=(0,l.logSessionStart)(o.sessionEvent),t=o.onModalClose;o.onModalClose=()=>{t&&t(),n&&(0,l.logSessionEnd)({sessionId:n,useSendBeacon:!0})}}},e.renameToSnakeCaseFormFields=e.renameToCamelCaseFormFields=e.objectKeyByValue=void 0;var o=babelHelpers.interopRequireDefault(r(d[0])),n=babelHelpers.interopRequireDefault(r(d[1])),t=babelHelpers.interopRequireDefault(r(d[2])),l=r(d[3]),s=r(d[4]);const u='logged_in_event',c=50;function f(o){n.default.isLoggedIn()?o():setTimeout((()=>f(o)),c)}function b(o){(0,t.default)()&&window.localStorage.setItem(u,JSON.stringify(o))}const p=o=>s.SignupFieldNames[o];e.renameToSnakeCaseFormFields=(o,n=!1)=>{const t=Object.keys(o).reduce(((n,t)=>({...n,[p(t)]:o[t]})),{});return n?{...t,national_number:o.phoneNumber}:t};const v=(o,n)=>{const t=Object.entries(o).find((o=>o[1]===n));return t&&t[0]||''};e.objectKeyByValue=v;e.renameToCamelCaseFormFields=(o,n=!1)=>{const t=Object.keys(o).reduce(((n,t)=>({...n,[v(s.SignupFieldNames,t)]:o[t]})),{});return n?{...t,phoneNumber:o.national_number}:t}}),"9f7af8",["abc3e4","06a99e","c916d0","9e7031","b48e39"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(s){const{default:u}=await t.scheduler.postTask(n);return u(s)};var t=r(d[0]);const n=()=>r(d[2])(d[1]).then(babelHelpers.interopRequireWildcard)}),"a2fd9f",["a2c93f","436356","c592d7"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SignupSocialFieldNames=e.SignupFieldNames=void 0;var n=r(d[0]);const o={[n.SignupFields.geetestChallenge]:'geetest_challenge',[n.SignupFields.geetestValidate]:'geetest_validate',[n.SignupFields.geetestSeccode]:'geetest_seccode'},l={[n.SignupFields.firstName]:'first_name',[n.SignupFields.lastName]:'last_name',[n.SignupFields.firstNamePreferred]:'first_name_preferred',[n.SignupFields.email]:'email',[n.SignupFields.password]:'password',[n.SignupFields.birthdateMonth]:'birthday_month',[n.SignupFields.birthdateDay]:'birthday_day',[n.SignupFields.birthdateYear]:'birthday_year',[n.SignupFields.receivePromotionalEmail]:'receive_promotional_email',[n.SignupFields.receivePromotionalSMS]:'receive_promotional_sms',[n.SignupFields.phoneNumber]:'phone',[n.SignupFields.countryCode]:'country_code',[n.SignupFields.verificationCode]:'verification_code',[n.SignupFields.tosCheckBox]:'tos_check_box',[n.SignupFields.collectionOfPersonalInformation]:'collection_of_personal_information',[n.SignupFields.overseasTransferOfPersonalData]:'overseas_transfer_of_personal_data',[n.SignupFields.phoneSignupFlow]:'phone_signup_flow',[n.SignupFields.redirectUrl]:'redirect_url'},s={...l,...o};e.SignupFieldNames=s;const t={[n.SignupSocialFields.oauth2Service]:'oauth2_service',[n.SignupSocialFields.providerUid]:'provider_uid',[n.SignupSocialFields.authType]:'auth_type',[n.SignupSocialFields.authCodeCacheKey]:'auth_code_cache_key',[n.SignupSocialFields.nationalNumber]:'national_number'},u={...l,...t};e.SignupSocialFieldNames=u}),"b48e39",["76b333"]);
__d((function(g,r,i,a,m,e,d){"use strict";let t;function o(){if(!('localStorage'in window))return!1;const t='__local_storage_feature_detector__';try{return window.localStorage.setItem(t,t),window.localStorage.removeItem(t),!0}catch(t){return!1}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){void 0===t&&(t=o());return t}}),"c916d0",[]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.changeCurrency=function(n){return t().default.post('/users/change_currency',{body:JSON.stringify({new_currency:n})})},e.replaceCurrencyParam=function(t,u={}){const o={...(0,n.parse)(window.location.search.slice(1)),display_currency:t,...u};o.currency&&(o.currency=t);o.guest_currency&&(o.guest_currency=t);o.price_min&&delete o.price_min;o.price_max&&delete o.price_max;const s=`?${(0,n.stringify)(o,{arrayFormat:'brackets'})}${window.location.hash}`;return(0,c.getHistory)().replace(s),s};var n=r(d[0]),c=r(d[1]);function t(){const n=babelHelpers.interopRequireDefault(r(d[2]));return t=function(){return n},n}babelHelpers.interopRequireDefault(r(d[3]))}),"d46747",["e950a3","7934b6","69a7c4","9b0a1c"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const{userAgent:t}=navigator;if((0,n.isAndroid)(t))return'ANDROID_VAPID';if((0,n.isIphone)(t))return'IPHONE_VAPID';if((0,n.isIpad)(t))return'IPAD_VAPID';return'DESKTOP_VAPID'};var n=r(d[0])}),"d93056",["e9b7bf"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t={document:void 0,getDocument:()=>r(d[1])(d[0]).then(babelHelpers.interopRequireWildcard).then((t=>t.default)),name:'SendPushTokenMutation',type:'mutation',operationId:'35f85d8e0ca316c774486242fa697b3b3dd26597467c7744cd45fc6d25282d1c'};e.default=t}),"dbdcfd",["27c779","c592d7"]);
__d((function(g,r,i,a,m,e,d){"use strict";function t(){const n=r(d[0]);return t=function(){return n},n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={RookeryMessagePackageEvent:t().RookeryMessagePackageEvent};e.default=n}),"e1839b",["ef628b"]);
__d((function(g,r,i,a,m,e,d){"use strict";function n(){const t=r(d[0]);return n=function(){return t},t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(t){const c=t||I();if(!c){const n='Cannot create device id with no user id';throw o((()=>n)),new Error(n)}const l=await h(),p=null==l?void 0:l.deviceId;if(p&&_(c,l))return o((()=>`Using "${p}" as stored device push id`)),p;const b=(0,n().v4)();return(0,u.storeInCache)(f,s,v({deviceId:b,userId:c})),b},e.hasValidDeviceId=async function(){const n=I();if(!n)return!1;const t=await h();return _(n,t)};var t=babelHelpers.interopRequireDefault(r(d[1])),u=r(d[2]),c=r(d[3]);const o=(0,c.createLogger)('Push:Device Id',(0,c.createPrefixStyle)('#b95f6f','#fff')),s='push_token_id',f='airbnb_push_notifications',l=':';function v({deviceId:n,userId:t}){return`${t}${l}${n}`}function I(){return t.default.current().id}function h(){return(0,u.getFromCache)(f,s).then((n=>{if(!n)return;const[t,u]=n.split(l);return{userId:+t,deviceId:u}}))}function _(n,t){return!(null==t||!t.deviceId||(null==t?void 0:t.userId)!==n)}}),"e62feb",["305dd5","06a99e","fe8083","102445"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RookeryMessagePackageEvent=void 0;var o={defaultProps:{schema:'com.airbnb.jitney.event.logging.Rookery:RookeryMessagePackageEvent:1.0.0',event_name:'rookery_message_package'},propTypes:{}};e.RookeryMessagePackageEvent=o,o.fullyQualifiedName='Rookery.v1.RookeryMessagePackageEvent'}),"ef628b",[]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createMarkMilestone=function(c,s="service_worker"){const l=(0,o.createLogger)(c,(0,o.createPrefixStyle)('rebeccapurple','#fff'));return function({count:o=1,options:c,metric:u,metricPrefix:f,description:p,tags:_}){const{datadogTags:b}=c,$=[b,_].filter(Boolean).join(','),j=null!=f?f:s;(0,t.airdogCount)(`${j}.milestone`,o,[`metric:${u}`,$].join(',')),n.default.getBootstrap('send_legacy_worker_metrics')&&(0,t.airdogCount)(`${j}.${u}`,o,$),p&&l((()=>[p,{datadogTags:$,metric:u}]))}};var t=r(d[0]),o=r(d[1]),n=babelHelpers.interopRequireDefault(r(d[2]))}),"fae72a",["3e4681","102445","c235f8"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.getServiceWorkerPath=C;var t=r(d[0]),n=babelHelpers.interopRequireDefault(r(d[1])),o=r(d[2]),s=babelHelpers.interopRequireDefault(r(d[3])),c=r(d[4]),l=r(d[5]),p=r(d[6]),_=r(d[7]),f=babelHelpers.interopRequireDefault(r(d[8])),v=babelHelpers.interopRequireDefault(r(d[9])),u=r(d[10]),h=r(d[11]),w=r(d[12]),b=r(d[13]),y=r(d[14]),k=babelHelpers.interopRequireDefault(r(d[15])),E=r(d[16]);const S=(0,c.createLogger)('ServiceWorker:Installer',(0,c.createPrefixStyle)('rebeccapurple','#fff')),T=(0,u.createMarkMilestone)('ServiceWorker:Installer');function A(t,n,o){const s=new URLSearchParams;Object.keys(n).forEach((t=>{const o=n[t];null!=o&&!1!==o&&s.append(t,String(o))})),o&&Object.keys(o).forEach((t=>{const n=o[t];null!=n&&s.append(t,String(n))}));const c=String(s);return c.length?`${t}?${c}`:t}function C(t,n={appType:'GLOBAL_TRAVEL',pushNotifications:!1,deliverAppShellExperiment:!1,deliverPreCachingExperiment:!1,deliverTripsOfflineExperiment:!1,dynamicPrecaching:!1,datadogTags:''}){var o,c,l;const{deliverAppShellExperiment:p,deliverPWAExperiment:_,deliverPreCachingExperiment:v,deliverTripsOfflineExperiment:u,disableAppShell:h,dynamicPrecaching:w}=n,{force_disable_3p_js:b,force_env:k,force_staging:E,offline:S,sw_workbox_dev_logs:T,utm_source:C,enableReactProfiler:L}=(0,f.default)();return A(t,{dynamic_precaching:w,deliver_app_shell_experiment:p,deliver_pre_caching_experiment:v,deliver_trips_offline_experiment:u,disable_app_shell:h,force_disable_3p_js:b,force_env:k,force_staging:E,enableReactProfiler:L,offline:S,sw_workbox_dev_logs:T,sw_disable_niobe_cache:null!==(o=(0,y.getTreatmentOverride)('sw_disable_niobe_cache'))&&void 0!==o?o:s.default.getBootstrap('sw_disable_niobe_cache'),sw_pwa_disable_niobe_cache:null!==(c=(0,y.getTreatmentOverride)('sw_pwa_disable_niobe_cache'))&&void 0!==c?c:s.default.getBootstrap('sw_pwa_disable_niobe_cache'),sw_allow_shell_on_search_verticals:null!==(l=(0,y.getTreatmentOverride)('sw_allow_shell_on_search_verticals'))&&void 0!==l?l:s.default.getBootstrap('sw_allow_shell_on_search_verticals'),utm_source:C},{sw_enable_offline:_})}function L(t,n){const{pushNotifications:o}=n;(0,l.addLoginCompleteCallback)((async()=>{await t.messageSW({type:'CLEAR_SHELL_CACHE'}),T({metric:'login_and_clear_cache',description:'Any caches storing an app shell have been cleared after login.',options:n}),o&&(0,h.updateSubscriptionIfOptedIn)()})),(0,l.addLogoutCallback)((async()=>{await t.messageSW({type:'CLEAR_SHELL_CACHE'}),T({metric:'logout_and_clear_cache',description:'Any caches storing an app shell have been cleared after logout.',options:n}),(0,h.clearSubscription)()}))}const R='skipping start of the service worker due to user opted out, remove your user from "temporarily_disable_service_workers_for_me" to opt back in.',W='service workers are globally disabled, skipping start';async function O(o,s={appType:'GLOBAL_TRAVEL',pushNotifications:!1,deliverTripsOfflineExperiment:!1,deliverAppShellExperiment:!1,deliverPreCachingExperiment:!1,dynamicPrecaching:!1,datadogTags:''}){const{appType:c,datadogTags:l,niobeClient:f,pushNotifications:u}=s,b=C(o,s),y=new t.Workbox(b,{updateViaCache:'all'}),E=`Initializing service worker at path: "${o}", see https://air.bb/service-workers for debugging guides.`;S((()=>[E,{pathWithParams:b}])),L(y,s),(0,p.addUpdateCurrencyCallback)((async()=>{await y.messageSW({type:'CLEAR_SHELL_CACHE'}),T({metric:'update_currency_and_clear_cache',description:'Any caches storing an app shell have been cleared after updating currency.',options:s}),u&&(0,h.updateSubscriptionIfOptedIn)()})),y.addEventListener('installed',(async t=>{T({options:s,metric:'installation',description:'Install event is fired'}),t.isUpdate?T({metric:'version_updated',description:'An installed service worker was updated to a new version.',options:s}):T({metric:'first_installation',description:'A new service worker has installed (for the first time)',options:s}),(s.dynamicPrecaching||s.deliverTripsOfflineExperiment)&&await y.messageSW({type:'PRECACHE_ASSETS',payload:{appVersion:"638b8a77db01efefe4a01d51ed5dcc8e184fa2a9"}})})),y.addEventListener('controlling',(async()=>{await y.messageSW({type:'FLUSH_MESSAGES'}),T({options:s,metric:'controlling',description:'The service worker is controlling the page, all behavior such as app shells, fetch handlers and push handlers are now ready.'})})),y.addEventListener('message',(t=>{switch(t.data.type){case'AIRDOG_BUMP':if('string'==typeof t.data.event)T({options:s,metric:`message.${t.data.event}`});else{const{name:n,count:o,tags:c}=t.data.event;T({count:o,options:s,metric:`message.${n}`,tags:c})}break;case'LOG_JITNEY_EVENT':n.default.logJitneyEvent({event_data:t.data.eventData,schema:k.default[t.data.schemaName]});break;case'SW_ERROR':T({description:'An error occurred in the service worker.',options:s,metric:'worker_error'}),(0,_.reportError)(t.data.error,{tags:{service_worker_error_type:'service_worker.worker_error'}});break;case'NOTIFICATION_CLICKED':T({description:'A push notification was clicked.',options:s,metric:'push_notification_clicked'}),(0,w.dispatchNotification)(t.data.payload)}})),y.addEventListener('activated',(async t=>{if(!t.isUpdate&&u){const t=await navigator.serviceWorker.getRegistration();t&&f&&(S((()=>'Initializing push notifications.')),await(0,v.default)({serviceWorkerRegistration:t,datadogTags:l,appType:c,niobeClient:f}))}T({description:'The service worker has finished activating.',options:s,metric:'activated_new_version'})})),y.addEventListener('waiting',(async()=>{if(await y.messageSW({type:'SKIP_WAITING'}))S((()=>'Manual reload signal in development received, reloading page')),location.reload(!0);else{const t='Automatic service worker activation failed, you may need to hard refresh the page to get the new worker.';S((()=>t))}T({options:s,metric:'waiting_to_install'})}));try{const t=await y.register();t&&u&&t.active&&f&&(S((()=>'Initializing push notifications.')),(0,v.default)({serviceWorkerRegistration:t,appType:c,datadogTags:l,niobeClient:f})),T({options:s,metric:'registration'})}catch(t){'SecurityError'!==(null==t?void 0:t.name)?T({description:'The service worker failed to install.',options:s,metric:'failed_installation'}):S((()=>['The service worker failed to install due to a SecurityError',t]))}}async function I(t){try{if((await navigator.serviceWorker.getRegistrations()).length){S((()=>'No service worker was registered but one is active, removing and if in development, reloading the page.'));try{(0,E.unregisterServiceWorker)({legacyOnly:!1})}finally{}}}catch(n){'SecurityError'!==(null==n?void 0:n.name)&&T({description:'The service worker failed to uninstall.',options:t,metric:'failed_uninstallation'})}}function P(t){return s.default.getBootstrap('disable_all_service_workers')||t}var x=async(t,n={})=>{if('undefined'==typeof navigator||!navigator.serviceWorker)return;const c=`registered_path:${t}`,l=(0,b.makeDatadogTags)(c),p={...n,datadogTags:[l,n.datadogTags].filter(Boolean).join(',')};if(!t)return void await I(p);T({options:p,metric:'initialization_attempt'});const{forceResetServiceWorker:_}=(0,f.default)();if(_)return await(0,E.unregisterServiceWorker)({legacyOnly:!1}),void(window.location.search=window.location.search.replace('forceResetServiceWorker','swResetComplete'));const v=s.default.getBootstrap('temporarily_disable_service_workers_for_me'),u=P(v),h=await C(t,p);try{await(0,E.unregisterServiceWorker)({legacyOnly:!u,serviceWorkerPath:h,datadogTags:l})}catch(n){u?S((()=>v?R:W)):(await O(t,p),(0,o.airdogCount)('service_worker.initialization_failed',1,l))}u?S((()=>v?R:W)):await O(t,p)};e.default=x}),"feb86f",["47df49","c8b97a","3e4681","c235f8","102445","9f7af8","737fda","f2f40f","a7c4ef","a2fd9f","fae72a","627c69","2d8379","159ba6","f9341a","e1839b","178ec4"]);
//# sourceMappingURL=https://sourcemaps.d.musta.ch/airbnb/static/packages/web/common/frontend/service-workers/initialize.5cb08e7665.js.map